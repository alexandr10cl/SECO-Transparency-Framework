{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/static/css/evaluation.css">
<link rel="stylesheet" href="/static/css/dropdown.css">
<link rel="stylesheet" href="/static/css/eval.css">
{% endblock %}

{% block title %}{{ evaluation.name}}{% endblock %}

{% block content %}
<div class="eval-page">

    <div class="eval-container">
        <!-- Header Section -->
        <header class="eval-header">
            <div class="eval-title-section">
                <a href="javascript:history.back()" class="back-btn">
                    <span class="back-icon">‚Üê</span>
                    <span>Back</span>
                </a>
                <h1 class="eval-title">{{ evaluation.name }}</h1>
                <div class="eval-actions">
                    <button class="settings-btn" id="openModalSettings" aria-label="Settings">
                        <span class="gear-icon">‚öôÔ∏è</span>
                    </button>
                </div>
            </div>
            
            <!-- Primary Action -->
            <div class="primary-action">
                <a href="{{ url_for('eval_dashboard', id=evaluation.evaluation_id) }}" class="dashboard-btn">
                    <span class="btn-icon">üìä</span>
                    <span>View Dashboard</span>
                </a>
            </div>
        </header>

        <!-- Main Content Grid -->
        <main class="eval-main">
            <!-- Left Column: Details + Procedures -->
            <section class="info-section">
                <!-- Evaluation Details -->
                <div class="info-card">
                    <h2 class="section-title">Evaluation Details</h2>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Evaluation Code</label>
                            <div class="info-value">
                                <code class="eval-code">{{ evaluation.evaluation_id }}</code>
                                <div class="warning-badge">
                                    <span class="warning-icon">‚ö†Ô∏è</span>
                                    <span>Expires in 30 days</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">Portal</label>
                            <div class="info-value">
                                <span class="portal-name">{{ evaluation.seco_portal }}</span>
                                <a href="{{ evaluation.seco_portal_url }}" class="portal-link" target="_blank">
                                    {{ evaluation.seco_portal_url }}
                                </a>
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">SECO Type</label>
                            <div class="info-value">
                                <span class="seco-type">{{ evaluation.seco_type.name.replace('_', ' ').title() if evaluation.seco_type else 'Not defined' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Procedures -->
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">üîÑ</span>
                        Procedures
                    </h3>
                    <div class="item-list">
                        {% for p in evaluation.seco_processes %}
                        <div class="item-badge">{{ p.seco_process_id }}</div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <!-- Right Column: Tasks (1 single column) -->
            <section class="tasks-section">
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">‚úÖ</span>
                        Tasks
                    </h3>
                    <div class="item-list">
                        {% for t in tasks %}
                        <div class="item-tag">{{ t.title }}</div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <!-- Guidelines - Full Width Below -->
            <section class="guidelines-section">
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">üìã</span>
                        Guidelines
                    </h3>
                    <div class="item-list">
                        {% for g in guidelines %}
                        <div class="item-tag">{{ g.title }}</div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <!-- Collected Data - Full Width Bottom -->
            {% if collected_data %}
            <section class="collected-data-section">
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Collected Data
                    </h3>
                    <div class="item-list">
                        {% for c in collected_data %}
                        <div class="item-badge">{{ c.collected_data_id }}</div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="modalConfig" class="modal inv">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-actions">
                    <a href="{{ url_for('edit_evaluation', id=evaluation.evaluation_id) }}" class="action-btn edit-btn">
                        <span class="btn-icon">‚úèÔ∏è</span>
                        Edit Evaluation
                    </a>
                    <a href="{{ url_for('delete_evaluation', id=evaluation.evaluation_id) }}" class="action-btn delete-btn" onclick="return confirm('Are you sure you want to delete this evaluation?')">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Delete Evaluation
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/eval.js"></script>
{% endblock %}
{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="/static/css/evaluation.css">
<link rel="stylesheet" href="/static/css/dropdown.css">
<link rel="stylesheet" href="/static/css/eval.css">
{% endblock %}

{% block title %}{{ evaluation.name}}{% endblock %}

{% block content %}
<div class="eval-page">
    <!-- Page Header with Breadcrumbs -->
    <div class="page-header">
        <div class="page-header-content">
            <nav class="breadcrumbs">
                <a href="{{ url_for('index') }}" class="breadcrumb-link">Home</a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <a href="{{ url_for('evaluations') }}" class="breadcrumb-link">Evaluations</a>
                <span class="breadcrumb-separator">‚Ä∫</span>
                <span class="breadcrumb-current">{{ evaluation.name }}</span>
            </nav>
            <h1 class="page-title">{{ evaluation.name }}</h1>
        </div>
    </div>

    <div class="eval-container">
        <!-- Action Header -->
        <header class="eval-header">
            <div class="eval-title-section">
                <a href="javascript:history.back()" class="back-btn">
                    <span class="back-icon">‚Üê</span>
                    <span>Back</span>
                </a>
                <div class="eval-actions">
                    <button class="settings-btn" id="openModalSettings" aria-label="Settings">
                        <span class="gear-icon">‚öôÔ∏è</span>
                    </button>
                    <a href="{{ url_for('eval_dashboard', id=evaluation.evaluation_id) }}" class="dashboard-btn">
                        <span class="btn-icon">üìä</span>
                        <span>View Dashboard</span>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content Grid -->
        <main class="eval-main">
            <!-- Left Column: Details + Procedures -->
            <section class="info-section">
                <!-- Evaluation Details -->
                <div class="info-card">
                    <h2 class="section-title">Evaluation Details</h2>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <label class="info-label">Evaluation Code</label>
                            <div class="info-value">
                                <code class="eval-code">{{ evaluation.evaluation_id }}</code>
                                <div class="warning-badge">
                                    <span class="warning-icon">‚ö†Ô∏è</span>
                                    <span>Expires in 30 days</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">Portal</label>
                            <div class="info-value">
                                <span class="portal-name">{{ evaluation.seco_portal }}</span>
                                <a href="{{ evaluation.seco_portal_url }}" class="portal-link" target="_blank">
                                    {{ evaluation.seco_portal_url }}
                                </a>
                            </div>
                        </div>

                        <div class="info-item">
                            <label class="info-label">SECO Type</label>
                            <div class="info-value">
                                <span class="seco-type">{{ evaluation.seco_type.name.replace('_', ' ').title() if evaluation.seco_type else 'Not defined' }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Collected Data -->
                {% if collected_data %}
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">üìä</span>
                        Collected Data
                    </h3>
                    <div class="item-list">
                        {% for c in collected_data %}
                        <div class="item-badge">{{ c.display_name }}</div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </section>

            <!-- Full Width Bottom: Procedures & Tasks -->
            <section class="procedures-tasks-section">
                <div class="related-card">
                    <h3 class="card-title">
                        <span class="card-icon">‚úÖ</span>
                        Procedures & Tasks
                    </h3>
                    <div class="procedures-tasks">
                        {% for proc_data in procedures_data %}
                        <div class="procedure-task-group">
                            <div class="procedure-header">
                                <span class="procedure-id">P{{ proc_data.process.seco_process_id }}</span>
                                <span class="procedure-description">{{ proc_data.process.description }}</span>
                            </div>
                            
                            {% if proc_data.guideline %}
                            <div class="procedure-guideline">
                                <div class="guideline-label">Guideline</div>
                                <div class="guideline-item">{{ proc_data.guideline.title }}</div>
                            </div>
                            {% endif %}
                            
                            <div class="procedure-tasks">
                                {% for task in proc_data.tasks %}
                                <div class="task-item">{{ task.title }}</div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Settings Modal -->
    <div id="modalConfig" class="modal inv">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-actions">
                    <a href="{{ url_for('edit_evaluation', id=evaluation.evaluation_id) }}" class="action-btn edit-btn">
                        <span class="btn-icon">‚úèÔ∏è</span>
                        Edit Evaluation
                    </a>
                    <a href="{{ url_for('delete_evaluation', id=evaluation.evaluation_id) }}" class="action-btn delete-btn" onclick="return confirm('Are you sure you want to delete this evaluation?')">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Delete Evaluation
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/eval.js"></script>
{% endblock %}